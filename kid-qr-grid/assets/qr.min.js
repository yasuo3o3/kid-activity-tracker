!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t=t||self).QRCode=r()}(this,function(){"use strict";function QRCode(options){if("string"==typeof options&&(options={text:options}),options=options||{},this.text=options.text||"",this.width=options.width||256,this.height=options.height||256,this.colorDark=options.colorDark||"#000000",this.colorLight=options.colorLight||"#ffffff",this.correctLevel=QRCode.CorrectLevel.M,this.type=-1,this.moduleCount=0,this.modules=null,this.dataCache=null,this.dataList=[],this.text){this.typeNumber=4;this.make()}}function QRPolynomial(t,r){if(null==t.length)throw Error(t.length+"/"+r);for(var e=0;e<t.length&&0==t[e];)e++;this.num=Array(t.length-e+r);for(var n=0;n<t.length-e;n++)this.num[n]=t[n+e]}QRCode.prototype={constructor:QRCode,make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,r){this.moduleCount=4*this.typeNumber+17,this.modules=Array(this.moduleCount);for(var e=0;e<this.moduleCount;e++){this.modules[e]=Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++)this.modules[e][n]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,r),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=QRCode.createData(this.typeNumber,this.correctLevel,this.dataList)),this.mapData(this.dataCache,r)},setupPositionProbePattern:function(t,r){for(var e=-1;7>=e;e++)if(!(-1>=t+e||this.moduleCount<=t+e))for(var n=-1;7>=n;n++)-1>=r+n||this.moduleCount<=r+n||(this.modules[t+e][r+n]=0<=e&&6>=e&&(0==n||6==n)||0<=n&&6>=n&&(0==e||6==e)||2<=e&&4>=e&&2<=n&&4>=n)},getBestMaskPattern:function(){for(var t=0,r=0,e=0;8>e;e++){this.makeImpl(!0,e);var n=QRUtil.getLostPoint(this);(0==e||t>n)&&(t=n,r=e)}return r},createMovieClip:function(t,r,e){var n=t.createEmptyMovieClip(r,e),a=1;this.make();for(var o=0;o<this.modules.length;o++){a*=1;for(var i=0;i<this.modules[o].length;i++){var s=a*i,l=a*o;this.modules[o][i]&&(n.beginFill(0,100),n.moveTo(s,l),n.lineTo(s+a,l),n.lineTo(s+a,l+a),n.lineTo(s,l+a),n.endFill())}}return n},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var r=8;r<this.moduleCount-8;r++)null==this.modules[6][r]&&(this.modules[6][r]=r%2==0)},setupPositionAdjustPattern:function(){for(var t=QRUtil.getPatternPosition(this.typeNumber),r=0;r<t.length;r++)for(var e=0;e<t.length;e++){var n=t[r],a=t[e];if(null==this.modules[n][a])for(var o=-2;2>=o;o++)for(var i=-2;2>=i;i++)this.modules[n+o][a+i]=-2==o||2==o||-2==i||2==i||0==o&&0==i}},setupTypeNumber:function(t){for(var r=QRUtil.getBCHTypeNumber(this.typeNumber),e=0;18>e;e++){var n=!t&&1==(r>>e&1);this.modules[Math.floor(e/3)][e%3+this.moduleCount-8-3]=n}for(var e=0;18>e;e++){var n=!t&&1==(r>>e&1);this.modules[e%3+this.moduleCount-8-3][Math.floor(e/3)]=n}},setupTypeInfo:function(t,r){for(var e=this.correctLevel<<3|r,n=QRUtil.getBCHTypeInfo(e),a=0;15>a;a++){var o=!t&&1==(n>>a&1);6>a?this.modules[a][8]=o:8>a?this.modules[a+1][8]=o:this.modules[this.moduleCount-15+a][8]=o}for(var a=0;15>a;a++){var o=!t&&1==(n>>a&1);8>a?this.modules[8][this.moduleCount-a-1]=o:9>a?this.modules[8][15-a-1+1]=o:this.modules[8][15-a-1]=o}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,r){for(var e=-1,n=this.moduleCount-1,a=7,o=0,i=this.moduleCount-1;i>0;i-=2)for(6==i&&i--;;){for(var s=0;2>s;s++)if(null==this.modules[n][i-s]){var l=!1;o<t.length&&(l=1==(t[o]>>>a&1));var u=QRUtil.getMask(r,n,i-s);u&&(l=!l),this.modules[n][i-s]=l,a--,-1==a&&(o++,a=7)}if(n+=e,0>n||this.moduleCount<=n){n-=e,e=-e;break}}}},QRCode.PAD0=236,QRCode.PAD1=17,QRCode.createData=function(t,r,e){for(var n=QRRSBlock.getRSBlocks(t,r),a=new QRBitBuffer,o=0;o<e.length;o++){var i=e[o];a.put(i.mode,4),a.put(i.getLength(),QRUtil.getLengthInBits(i.mode,t)),i.write(a)}for(var s=0,o=0;o<n.length;o++)s+=n[o].dataCount;if(a.getLengthInBits()>8*s)throw Error("code length overflow. ("+a.getLengthInBits()+">"+8*s+")");for(a.getLengthInBits()+4<=8*s&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(!1);for(;;){if(a.getLengthInBits()>=8*s)break;if(a.put(QRCode.PAD0,8),a.getLengthInBits()>=8*s)break;a.put(QRCode.PAD1,8)}return QRCode.createBytes(a,n)},QRCode.createBytes=function(t,r){for(var e=0,n=0,a=0,o=Array(r.length),i=Array(r.length),s=0;s<r.length;s++){var l=r[s].dataCount,u=r[s].totalCount-l;n=Math.max(n,l),a=Math.max(a,u),o[s]=Array(l);for(var h=0;h<o[s].length;h++)o[s][h]=255&t.buffer[h+e];e+=l;var f=QRUtil.getErrorCorrectPolynomial(u),c=new QRPolynomial(o[s],f.getLength()-1),g=c.mod(f);i[s]=Array(f.getLength()-1);for(var h=0;h<i[s].length;h++){var d=h+g.getLength()-i[s].length;i[s][h]=d>=0?g.get(d):0}}for(var m=0,h=0;h<r.length;h++)m+=r[h].totalCount;for(var v=Array(m),w=0,h=0;n>h;h++)for(var s=0;s<r.length;s++)h<o[s].length&&(v[w++]=o[s][h]);for(var h=0;a>h;h++)for(var s=0;s<r.length;s++)h<i[s].length&&(v[w++]=i[s][h]);return v},QRCode.CorrectLevel={M:0,L:1,H:2,Q:3},QRCode.toCanvas=function(t,r,e){e=e||{};var n=t.getContext("2d"),a=t.width,o=t.height,i=a/(r.moduleCount||21);n.clearRect(0,0,a,o),n.fillStyle=e.colorLight||"#ffffff",n.fillRect(0,0,a,o),n.fillStyle=e.colorDark||"#000000";for(var s=0;s<r.moduleCount;s++)for(var l=0;l<r.moduleCount;l++)r.modules[s][l]&&n.fillRect(l*i,s*i,i,i)},QRPolynomial.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var r=Array(this.getLength()+t.getLength()-1),e=0;e<this.getLength();e++)for(var n=0;n<t.getLength();n++)r[e+n]^=QRMath.gexp(QRMath.glog(this.get(e))+QRMath.glog(t.get(n)));return new QRPolynomial(r,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var r=QRMath.glog(this.get(0))-QRMath.glog(t.get(0)),e=Array(this.getLength()),n=0;n<this.getLength();n++)e[n]=this.get(n);for(var n=0;n<t.getLength();n++)e[n]^=QRMath.gexp(QRMath.glog(t.get(n))+r);return new QRPolynomial(e,0).mod(t)}};var QRMath={glog:function(t){if(1>t)throw Error("glog("+t+")");return QRMath.LOG_TABLE[t]},gexp:function(t){for(;0>t;)t+=255;for(;t>=256;)t-=255;return QRMath.EXP_TABLE[t]},EXP_TABLE:Array(256),LOG_TABLE:Array(256)};for(var i=0;8>i;i++)QRMath.EXP_TABLE[i]=1<<i;for(var i=8;256>i;i++)QRMath.EXP_TABLE[i]=QRMath.EXP_TABLE[i-4]^QRMath.EXP_TABLE[i-5]^QRMath.EXP_TABLE[i-6]^QRMath.EXP_TABLE[i-8];for(var i=0;255>i;i++)QRMath.LOG_TABLE[QRMath.EXP_TABLE[i]]=i;function QRRSBlock(t,r){this.totalCount=t,this.dataCount=r}function QRBitBuffer(){this.buffer=[],this.length=0}function QR8bitByte(t){this.mode=QRMode.MODE_8BIT_BYTE,this.data=t}function QRMode(){}QRRSBlock.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16]],QRRSBlock.getRSBlocks=function(t,r){var e=QRRSBlock.getRsBlockTable(t,r);if(null==e)throw Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+r);for(var n=e.length/3,a=[],o=0;o<n;o++)for(var i=e[3*o+0],s=e[3*o+1],l=e[3*o+2],u=0;u<i;u++)a.push(new QRRSBlock(s,l));return a},QRRSBlock.getRsBlockTable=function(t,r){switch(r){case QRCode.CorrectLevel.L:return QRRSBlock.RS_BLOCK_TABLE[4*(t-1)+0];case QRCode.CorrectLevel.M:return QRRSBlock.RS_BLOCK_TABLE[4*(t-1)+1];case QRCode.CorrectLevel.Q:return QRRSBlock.RS_BLOCK_TABLE[4*(t-1)+2];case QRCode.CorrectLevel.H:return QRRSBlock.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},QRBitBuffer.prototype={get:function(t){var r=Math.floor(t/8);return 1==(this.buffer[r]>>>7-t%8&1)},put:function(t,r){for(var e=0;e<r;e++)this.putBit(1==(t>>>r-e-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var r=Math.floor(this.length/8);this.buffer.length<=r&&this.buffer.push(0),t&&(this.buffer[r]|=128>>>this.length%8),this.length++}},QR8bitByte.prototype={getLength:function(){return this.data.length},write:function(t){for(var r=0;r<this.data.length;r++)t.put(this.data.charCodeAt(r),8)}},QRMode.MODE_NUMBER=1,QRMode.MODE_ALPHA_NUM=2,QRMode.MODE_8BIT_BYTE=4,QRMode.MODE_KANJI=8;var QRUtil={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var r=t<<10;QRUtil.getBCHDigit(r)-QRUtil.getBCHDigit(QRUtil.G15)>=0;)r^=QRUtil.G15<<QRUtil.getBCHDigit(r)-QRUtil.getBCHDigit(QRUtil.G15);return(t<<10|r)^QRUtil.G15_MASK},getBCHTypeNumber:function(t){for(var r=t<<12;QRUtil.getBCHDigit(r)-QRUtil.getBCHDigit(QRUtil.G18)>=0;)r^=QRUtil.G18<<QRUtil.getBCHDigit(r)-QRUtil.getBCHDigit(QRUtil.G18);return t<<12|r},getBCHDigit:function(t){for(var r=0;0!=t;)r++,t>>>=1;return r},getPatternPosition:function(t){return QRUtil.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,r,e){switch(t){case 0:return(r+e)%2==0;case 1:return r%2==0;case 2:return e%3==0;case 3:return(r+e)%3==0;case 4:return(Math.floor(r/2)+Math.floor(e/3))%2==0;case 5:return r*e%2+r*e%3==0;case 6:return(r*e%2+r*e%3)%2==0;case 7:return(r*e%3+(r+e)%2)%2==0;default:throw Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var r=new QRPolynomial([1],0),e=0;e<t;e++)r=r.multiply(new QRPolynomial([1,QRMath.gexp(e)],0));return r},getLengthInBits:function(t,r){if(1<=r&&10>r)switch(t){case QRMode.MODE_NUMBER:return 10;case QRMode.MODE_ALPHA_NUM:return 9;case QRMode.MODE_8BIT_BYTE:return 8;case QRMode.MODE_KANJI:return 8;default:throw Error("mode:"+t)}else if(27>r)switch(t){case QRMode.MODE_NUMBER:return 12;case QRMode.MODE_ALPHA_NUM:return 11;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 10;default:throw Error("mode:"+t)}else{if(!(41>r))throw Error("type:"+r);switch(t){case QRMode.MODE_NUMBER:return 14;case QRMode.MODE_ALPHA_NUM:return 13;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 12;default:throw Error("mode:"+t)}}},getLostPoint:function(t){for(var r=t.moduleCount,e=0,n=0;n<r;n++)for(var a=0;a<r;a++){for(var o=0,i=t.modules[n][a],s=-1;1>=s;s++)if(!(0>n+s||r<=n+s))for(var l=-1;1>=l;l++)0>a+l||r<=a+l||0==s&&0==l||i==t.modules[n+s][a+l]&&o++;o>5&&(e+=3+o-5)}for(var n=0;n<r-1;n++)for(var a=0;a<r-1;a++){var u=0;t.modules[n][a]&&u++,t.modules[n+1][a]&&u++,t.modules[n][a+1]&&u++,t.modules[n+1][a+1]&&u++,0!=u&&4!=u||(e+=3)}for(var n=0;n<r;n++)for(var a=0;a<r-6;a++)t.modules[n][a]&&!t.modules[n][a+1]&&t.modules[n][a+2]&&t.modules[n][a+3]&&t.modules[n][a+4]&&!t.modules[n][a+5]&&t.modules[n][a+6]&&(e+=40);for(var a=0;a<r;a++)for(var n=0;n<r-6;n++)t.modules[n][a]&&!t.modules[n+1][a]&&t.modules[n+2][a]&&t.modules[n+3][a]&&t.modules[n+4][a]&&!t.modules[n+5][a]&&t.modules[n+6][a]&&(e+=40);for(var h=0,a=0;a<r;a++)for(var n=0;n<r;n++)t.modules[n][a]&&h++;var f=Math.abs(100*h/r/r-50)/5;return e+=10*f}};return QRCode.prototype.addData=function(t){var r=new QR8bitByte(t);this.dataList.push(r),this.dataCache=null},QRCode.prototype.isDark=function(t,r){if(0>t||this.moduleCount<=t||0>r||this.moduleCount<=r)throw Error(t+","+r);return this.modules[t][r]},QRCode.prototype.getModuleCount=function(){return this.moduleCount},QRCode.prototype.toCanvas=function(t,r){QRCode.toCanvas(t,this,r||{})},QRCode});